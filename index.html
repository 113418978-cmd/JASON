<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>è™šæ‹Ÿèµ›é©¬æ¸¸æˆï¼ˆå¨±ä¹ç”¨ï¼Œæ— ä»»ä½•çœŸå®è´§å¸ï¼‰</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        "Helvetica Neue", Arial, "PingFang SC", "Microsoft YaHei", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 40px 10px;
    }

    .container {
      width: 100%;
      max-width: 900px;
      background: #020617;
      border-radius: 18px;
      padding: 24px 24px 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
      border: 1px solid #1f2937;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .title {
      font-size: 22px;
      font-weight: 700;
    }

    .subtitle {
      font-size: 12px;
      color: #9ca3af;
      margin-top: 4px;
    }

    .balance {
      padding: 8px 14px;
      border-radius: 999px;
      background: #111827;
      font-size: 14px;
    }

    .balance span.amount {
      font-weight: 700;
      color: #facc15;
    }

    .panel {
      margin-top: 14px;
      padding: 16px 18px;
      border-radius: 14px;
      background: #020617;
      border: 1px solid #1f2937;
    }

    .panel h2 {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-bottom: 10px;
    }

    label {
      font-size: 13px;
      color: #9ca3af;
    }

    select,
    input[type="number"] {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #020617;
      color: #e5e7eb;
      font-size: 14px;
      min-width: 120px;
    }

    select:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #3b82f6;
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 14px;
      font-weight: 500;
      background: #3b82f6;
      color: white;
      transition: transform 0.05s ease, box-shadow 0.05s ease, opacity 0.2s;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: none;
    }

    button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .hint {
      font-size: 12px;
      color: #6b7280;
      margin-top: 4px;
    }

    .race-track {
      margin-top: 18px;
      padding: 16px 18px;
      border-radius: 14px;
      background: #020617;
      border: 1px solid #1f2937;
    }

    .horse-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .horse-name {
      width: 70px;
      font-size: 13px;
      color: #e5e7eb;
    }

    .track {
      position: relative;
      flex: 1;
      height: 18px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid #374151;
      overflow: hidden;
    }

    .horse-progress {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 0;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #4ade80);
      transition: width 0.08s linear;
    }

    .horse-emoji {
      width: 26px;
      text-align: center;
      font-size: 18px;
    }

    .log {
      margin-top: 14px;
      padding: 14px 16px;
      border-radius: 14px;
      background: #020617;
      border: 1px solid #1f2937;
      max-height: 180px;
      overflow-y: auto;
      font-size: 12px;
    }

    .log-entry {
      margin-bottom: 6px;
    }

    .log-entry.win {
      color: #4ade80;
    }

    .log-entry.lose {
      color: #f97373;
    }

    .log-entry.info {
      color: #9ca3af;
    }

    .footer {
      margin-top: 10px;
      font-size: 11px;
      color: #6b7280;
      text-align: right;
    }

    .warning {
      margin-top: 8px;
      font-size: 11px;
      color: #fbbf24;
    }

    @media (max-width: 640px) {
      .container {
        padding: 16px 14px 22px;
      }
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div>
        <div class="title">è™šæ‹Ÿèµ›é©¬æ¸¸æˆ</div>
        <div class="subtitle">çº¯å¨±ä¹ç”¨ Â· è™šæ‹Ÿé‡‘å¸ Â· ä¸æ¶‰åŠä»»ä½•çœŸå®è´§å¸æˆ–å¥–åŠ±</div>
      </div>
      <div class="balance">
        å½“å‰é‡‘å¸ï¼š<span class="amount" id="balance">0</span>
      </div>
    </header>

    <section class="panel">
      <h2>ä¸‹æ³¨åŒºåŸŸ</h2>
      <div class="form-row">
        <div>
          <label for="horseSelect">é€‰æ‹©èµ›é©¬ï¼š</label>
          <select id="horseSelect">
            <option value="0">1 å·é©¬ï¼ˆèµ¤ç„°ï¼‰</option>
            <option value="1">2 å·é©¬ï¼ˆé’å½±ï¼‰</option>
            <option value="2">3 å·é©¬ï¼ˆé»‘é£ï¼‰</option>
            <option value="3">4 å·é©¬ï¼ˆç™½äº‘ï¼‰</option>
          </select>
        </div>

        <div>
          <label for="betAmount">ä¸‹æ³¨é‡‘å¸ï¼š</label>
          <input
            id="betAmount"
            type="number"
            min="1"
            step="1"
            placeholder="ä¾‹å¦‚ 50"
          />
        </div>

        <div>
          <button id="btnMax">ALL INï¼ˆå…¨éƒ¨é‡‘å¸ï¼‰</button>
        </div>

        <div>
          <button id="startRaceBtn">å¼€å§‹èµ›é©¬</button>
        </div>
      </div>
      <div class="hint">
        å¥–åŠ±è§„åˆ™ï¼šæŠ¼ä¸­è·èƒœé©¬ â†’ è·å¾— <strong>ä¸‹æ³¨é‡‘é¢ Ã— 2</strong>ï¼Œå¦åˆ™å¤±å»ä¸‹æ³¨é‡‘é¢ã€‚  
        å»ºè®®ç†æ€§å¨±ä¹ï¼Œç ”ç©¶æ¦‚ç‡ï¼Œä¸è¦ä»£å…¥ç°å®ã€‚
      </div>
      <div class="warning">
        æœ¬é¡µé¢ä»…ç”¨äºä¸ªäººç ”ç©¶ / å­¦ä¹  / å¨±ä¹ï¼Œæ‰€æœ‰é‡‘å¸ä¸ºè™šæ‹Ÿæ•°å€¼ï¼Œä¸å…·ä»»ä½•ç°å®ä»·å€¼ã€‚
      </div>
    </section>

    <section class="race-track">
      <h2>èµ›é“</h2>
      <div id="tracksContainer">
        <!-- èµ›é“ä¼šç”± JS åŠ¨æ€ç”Ÿæˆ -->
      </div>
    </section>

    <section class="log" id="log">
      <!-- æ—¥å¿—ä¼šç”± JS åŠ¨æ€åŠ å…¥ -->
    </section>

    <div class="footer">
      ä»…ä¾›ä¸ªäººå­¦ä¹ ä¸å¨±ä¹ Â· æ— çœŸå®è´§å¸å¾€æ¥ Â· æ— ä»»ä½•ç°å®å¥–åŠ±
    </div>
  </div>

  <script>
    // ======== åŸºæœ¬é…ç½® ========
    const INITIAL_BALANCE = 1000;
    const HORSES = [
      { id: 0, name: "1 å·é©¬Â·èµ¤ç„°", emoji: "ğŸ" },
      { id: 1, name: "2 å·é©¬Â·é’å½±", emoji: "ğŸ´" },
      { id: 2, name: "3 å·é©¬Â·é»‘é£", emoji: "ğŸ¦„" },
      { id: 3, name: "4 å·é©¬Â·ç™½äº‘", emoji: "ğŸ" }
    ];

    let balance = 0;
    let isRacing = false;
    let raceInterval = null;

    const balanceEl = document.getElementById("balance");
    const horseSelectEl = document.getElementById("horseSelect");
    const betAmountEl = document.getElementById("betAmount");
    const startRaceBtn = document.getElementById("startRaceBtn");
    const btnMax = document.getElementById("btnMax");
    const tracksContainer = document.getElementById("tracksContainer");
    const logEl = document.getElementById("log");

    // ======== åˆå§‹åŒ–é‡‘å¸ ========
    function loadBalance() {
      const saved = localStorage.getItem("virtual_horse_balance");
      if (saved !== null && !isNaN(parseInt(saved))) {
        balance = parseInt(saved);
      } else {
        balance = INITIAL_BALANCE;
        localStorage.setItem("virtual_horse_balance", balance);
      }
      renderBalance();
    }

    function renderBalance() {
      balanceEl.textContent = balance;
    }

    function updateBalance(newVal) {
      balance = newVal;
      renderBalance();
      localStorage.setItem("virtual_horse_balance", balance);
    }

    // ======== åˆ›å»ºèµ›é“ UI ========
    function createTracks() {
      tracksContainer.innerHTML = "";
      HORSES.forEach((horse) => {
        const row = document.createElement("div");
        row.className = "horse-row";

        const name = document.createElement("div");
        name.className = "horse-name";
        name.textContent = horse.name;

        const track = document.createElement("div");
        track.className = "track";

        const progress = document.createElement("div");
        progress.className = "horse-progress";
        progress.id = `horse-progress-${horse.id}`;

        const emoji = document.createElement("div");
        emoji.className = "horse-emoji";
        emoji.textContent = horse.emoji;

        track.appendChild(progress);
        row.appendChild(name);
        row.appendChild(track);
        row.appendChild(emoji);
        tracksContainer.appendChild(row);
      });
    }

    function resetTracks() {
      HORSES.forEach((horse) => {
        const progress = document.getElementById(`horse-progress-${horse.id}`);
        if (progress) {
          progress.style.width = "0%";
        }
      });
    }

    // ======== æ—¥å¿— ========
    function addLog(message, type = "info") {
      const entry = document.createElement("div");
      entry.className = `log-entry ${type}`;
      const time = new Date().toLocaleTimeString();
      entry.textContent = `[${time}] ${message}`;
      logEl.prepend(entry);
    }

    // ======== èµ›é©¬é€»è¾‘ ========
    function startRace() {
      if (isRacing) return;

      const selectedHorseId = parseInt(horseSelectEl.value);
      let bet = parseInt(betAmountEl.value);

      if (isNaN(bet) || bet <= 0) {
        alert("è¯·è¾“å…¥æ­£ç¡®çš„ä¸‹æ³¨é‡‘å¸æ•°é‡ï¼ˆæ­£æ•´æ•°ï¼‰");
        return;
      }

      if (bet > balance) {
        alert("ä¸‹æ³¨é‡‘é¢ä¸èƒ½è¶…è¿‡å½“å‰é‡‘å¸ï¼");
        return;
      }

      // é”å®šçŠ¶æ€
      isRacing = true;
      startRaceBtn.disabled = true;
      btnMax.disabled = true;
      horseSelectEl.disabled = true;
      betAmountEl.disabled = true;

      resetTracks();

      addLog(
        `æœ¬å±€ä¸‹æ³¨ï¼šé€‰æ‹©ã€Œ${HORSES[selectedHorseId].name}ã€ï¼Œä¸‹æ³¨ ${bet} é‡‘å¸ã€‚`,
        "info"
      );

      const horsePositions = HORSES.map(() => 0);
      const finishLine = 100;
      let winnerId = null;

      raceInterval = setInterval(() => {
        HORSES.forEach((horse, index) => {
          if (winnerId !== null) return;

          // æ¯ä¸€æ­¥çš„éšæœºå‰è¿›é€Ÿåº¦ï¼ˆå¯ä»¥è‡ªå·±è°ƒå‚ï¼‰
          const step = Math.random() * 4 + 1; // 1 ~ 5
          horsePositions[index] = Math.min(
            finishLine,
            horsePositions[index] + step
          );

          const progressEl = document.getElementById(
            `horse-progress-${horse.id}`
          );
          if (progressEl) {
            progressEl.style.width = horsePositions[index] + "%";
          }

          if (horsePositions[index] >= finishLine && winnerId === null) {
            winnerId = horse.id;
            endRace(winnerId, selectedHorseId, bet);
          }
        });
      }, 80);
    }

    function endRace(winnerId, selectedHorseId, bet) {
      clearInterval(raceInterval);
      raceInterval = null;
      isRacing = false;

      // è§£é”æŒ‰é’®
      startRaceBtn.disabled = false;
      btnMax.disabled = false;
      horseSelectEl.disabled = false;
      betAmountEl.disabled = false;

      const winnerHorse = HORSES.find((h) => h.id === winnerId);
      addLog(`æœ¬å±€å† å†›ï¼š${winnerHorse.name}ï¼`, "info");

      if (winnerId === selectedHorseId) {
        const reward = bet * 2;
        updateBalance(balance + bet); // å‡€èµš bet
        addLog(
          `æ­å–œæŠ¼ä¸­ï¼ä¸‹æ³¨ ${bet}ï¼Œè¿”è¿˜ ${reward}ï¼Œå‡€èµš ${bet} é‡‘å¸ã€‚å½“å‰é‡‘å¸ï¼š${balance}`,
          "win"
        );
      } else {
        updateBalance(balance - bet);
        addLog(
          `æœªæŠ¼ä¸­ï¼Œæœ¬å±€æŸå¤± ${bet} é‡‘å¸ã€‚å½“å‰é‡‘å¸ï¼š${balance}`,
          "lose"
        );
      }

      if (balance <= 0) {
        addLog(
          "é‡‘å¸å·²ç”¨å®Œï¼Œå°†è‡ªåŠ¨é‡ç½®ä¸ºåˆå§‹é‡‘å¸ï¼ˆä»…ä¸ºå¨±ä¹ç”¨é€”ï¼‰ã€‚",
          "info"
        );
        updateBalance(INITIAL_BALANCE);
      }
    }

    // ======== äº‹ä»¶ç»‘å®š ========
    startRaceBtn.addEventListener("click", startRace);

    btnMax.addEventListener("click", () => {
      betAmountEl.value = balance;
    });

    // ======== åˆå§‹åŒ– ========
    loadBalance();
    createTracks();
    addLog("æ¬¢è¿æ¥åˆ°è™šæ‹Ÿèµ›é©¬æ¸¸æˆï¼šä»…ä¾›å­¦ä¹ ä¸å¨±ä¹ï¼Œä¸å«ä»»ä½•çœŸå®è´§å¸ã€‚", "info");
  </script>
</body>
</html>
